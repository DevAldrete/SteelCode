# Code Analyzer VS Code Extension

## Overview

The Code Analyzer VS Code Extension provides a user interface within VS Code to analyze code. It allows users to input code snippets or select files (feature to be implemented) and view analysis results, such as potential issues, complexity metrics, and more. The UI is built using web technologies (React, Material UI) and rendered inside a VS Code Webview Panel.

This extension serves as the bridge between the VS Code environment and the webview UI, managing the webview's lifecycle and facilitating two-way communication.

## How to Build and Run

### Prerequisites

*   [Node.js](https://nodejs.org/) (LTS version recommended, e.g., 18.x or 20.x)
*   [pnpm](https://pnpm.io/) (Package manager, version specified in `package.json`'s `packageManager` field, e.g., `pnpm@10.11.0`)

### Installation

1.  **Install Extension Dependencies:**
    Navigate to the extension's root directory (`web/vscode-extension/`) and run:
    ```bash
    pnpm install
    ```
    This installs dependencies like `@types/vscode` and `typescript`.

2.  **Install Webview UI Dependencies:**
    Navigate to the webview UI directory (`web/vscode-extension/webview-ui/`) and run:
    ```bash
    pnpm install
    ```
    This installs React, Material UI, TanStack libraries, and other UI-related dependencies. The `pnpm install` command should be run using the pnpm version specified in `webview-ui/package.json` (e.g., `npx pnpm@10.11.0 install` if you have npx available and need to use a specific pnpm version).

### Compiling the Extension

To compile the TypeScript code for the extension, run the following command in the `web/vscode-extension/` directory:

```bash
pnpm run compile
```
This will transpile the TypeScript files from `src/` to JavaScript files in the `out/` directory, as configured in `tsconfig.json`. This step is usually automatically run as part of `vscode:prepublish` script before packaging the extension.

### Running the Extension in VS Code

1.  **Open the Project:**
    Open the root folder of this repository (the one containing `web/vscode-extension/`) in Visual Studio Code.

2.  **Start Debugging (Launch Extension Development Host):**
    *   Press `F5`. This is the default key to start debugging and will open a new VS Code window titled "[Extension Development Host]".
    *   Alternatively, you can go to the "Run and Debug" view (Ctrl+Shift+D or Cmd+Shift+D on Mac), ensure "Run Extension" is selected in the dropdown, then click the green play button.

3.  **Open the Code Analyzer Panel:**
    Once the Extension Development Host window is active:
    *   Open the Command Palette (Ctrl+Shift+P or Cmd+Shift+P on Mac).
    *   Type "Show Code Analyzer Panel" and select the command.
    *   This will open the webview panel, typically in its own editor tab.

## Architecture

The extension consists of two main parts:

1.  **VS Code Extension (`src/extension.ts`):**
    *   This is the core of the extension that interacts with the VS Code API.
    *   It's responsible for registering commands (like opening the webview panel), creating and managing the webview panel itself, and handling communication to/from the webview.
    *   The main logic is within `src/extension.ts`.
    *   It also handles any direct interactions with the VS Code workspace, filesystem, or backend services (like the simulated API call in this example).

2.  **Webview UI (`webview-ui/`):**
    *   This is a separate web application (built with React, Material UI, TanStack Query, and TanStack Router) that provides the user interface displayed within the webview panel.
    *   It's located in the `webview-ui/` directory and has its own `package.json` for dependencies and build scripts (e.g., using Rsbuild).
    *   The UI is built into static assets (HTML, CSS, JavaScript) which are then loaded by the webview panel. The paths to these assets are dynamically constructed in `extension.ts` to work with VS Code's security model (`asWebviewUri`).

### Communication Mechanism

Communication between the extension and the webview UI is achieved using VS Code's `postMessage` API.

*   **Extension to Webview:** The extension can send messages to the webview using `panel.webview.postMessage({ type: '...', payload: ... })`.
*   **Webview to Extension:** The webview UI can send messages to the extension using `vscode.postMessage({ type: '...', payload: ... })` (where `vscode` is an API object acquired by `acquireVsCodeApi()` in the webview).

A request/response pattern is implemented to facilitate more complex interactions, especially for data fetching or operations initiated by the webview that require action from the extension:
*   Messages typically include a `type` (to identify the action/command) and a `payload`.
*   For request-response, a unique `requestId` is generated by the initiator (usually the webview). The responder (the extension) includes this `requestId` in its response message.
*   This allows the initiator to match responses to their original requests, enabling asynchronous operations to be handled with promises.
*   This pattern is primarily managed in `webview-ui/src/vscodeApi.ts`, which provides helper functions like `postMessageWithResponse`.

### Key Files

*   **`web/vscode-extension/src/extension.ts`:** The main entry point for the VS Code extension logic. Handles panel creation, command registration, message routing with the webview, and any backend interactions.
*   **`web/vscode-extension/webview-ui/src/vscodeApi.ts`:** Contains the logic for communication between the webview UI and the extension, including the promise-based request/response mechanism (`postMessageWithResponse`) and general message listening (`addMessageListener`).
*   **`web/vscode-extension/webview-ui/src/App.tsx`:** The main layout component for the React-based webview UI. It sets up routing using TanStack Router (`<Outlet />`) and can provide global context to child routes.
*   **`web/vscode-extension/webview-ui/package.json`:** Defines dependencies and build scripts for the webview UI.
*   **`web/vscode-extension/package.json`:** Defines dependencies and build scripts for the extension itself.
*   **`web/vscode-extension/tsconfig.json`:** TypeScript configuration for the extension.
*   **`web/vscode-extension/webview-ui/tsconfig.json`:** TypeScript configuration for the webview UI.
